# Scorpio.Unit

## Scorpio.Secure.UnitFrame & Indicators

Let's start a simple example to create an unit frame represents the player:

```lua
LoadAddOn("Scorpio.Unit") -- Make sure the Scorpio.Unit is loaded

Scorpio "Test" ""

import "Scorpio.Secure"

playerFrame                     = UnitFrame("Player")

Style[playerFrame]              = {
    unit                        = "player",
    location                    = { Anchor("CENTER") },
    size                        = Size(120, 36),

    healthBar                   = {
        setAllPoints            = true,

        frameStrata             = "LOW",
        enableMouse             = false,
        statusBarTexture        = {
            file                = [[Interface\Buttons\WHITE8x8]]
        },

        value                   = Wow.UnitHealth(),
        minMaxValues            = Wow.UnitHealthMax(),
        statusBarColor          = Wow.UnitColor(),

        backgroundFrame         = {
            frameStrata         = "BACKGROUND",
            location            = { Anchor("TOPLEFT", -1, 1), Anchor("BOTTOMRIGHT", 1, -1) },
            backgroundTexture   = {
                drawLayer       = "BACKGROUND",
                setAllPoints    = true,
                color           = Color(0.2, 0.2, 0.2, 0.8),
            },
            backdrop            = {
                edgeFile        = [[Interface\Buttons\WHITE8x8]],
                edgeSize        = 1,
            },

            backdropBorderColor = Color.BLACK,
        },
    }, 

    nameLabel                   = {
        location                = { Anchor("CENTER") },

        drawLayer               = "BORDER",
        fontObject              = GameFontNormalSmall,
        text                    = Wow.UnitName(true),
        textColor               = Wow.UnitColor(),
    },
}
```

![Player Frame](./pics/unit_playerframe.jpg)

The **UnitFrame** provide the basic secure unit frame mechanism and hover spell cast features. 
That'll be introduced later.

We can use the Cube's Browser to check the `Scorpio.Secure.UnitFrame`, there are many special
child properties can be used as indicators, like the `healthBar` and `nameLabel`.

![Unit Frame Child Property](./pics/unit_unitframe_childprop.jpg)

The declaration of those indicators are very simple, take the `nameLabel` as example:

```lua
-- Mark the NameLabel as UnitFrame class's child property(indicator)
__ChildProperty__(UnitFrame,         "NameLabel") 

-- Mark the NameLabel as InSecureUnitFrame class's child property(indicator)
-- The InSecureUnitFrame are used on nameplate
__ChildProperty__(InSecureUnitFrame, "NameLabel")
__Sealed__() class "NameLabel"       { FontString }
```

You can check [Indicator.lua](https://github.com/kurapica/Scorpio/blob/master/Scorpio.Unit/Modules/Indicator.lua#L17-L83)
for more details.

The file also provide default skins for those indicators:

```lua
Style.UpdateSkin("Default",     {
    [NameLabel]                 = {
        drawLayer               = "BORDER",
        fontObject              = GameFontNormalSmall,
        text                    = Wow.UnitName(true),
        textColor               = Wow.UnitColor(),
    },
}
```

So we can sinmple the example like :

```lua
LoadAddOn("Scorpio.Unit") -- Make sure the Scorpio.Unit is loaded

Scorpio "Test" ""

import "Scorpio.Secure"

playerFrame                     = UnitFrame("Player")

Style[playerFrame]              = {
    unit                        = "player",
    location                    = { Anchor("CENTER") },
    size                        = Size(120, 36),

    healthBar                   = {
        setAllPoints            = true,

        statusBarTexture        = {
            file                = [[Interface\Buttons\WHITE8x8]]
        },

        backgroundFrame         = {
            frameStrata         = "BACKGROUND",
            location            = { Anchor("TOPLEFT", -1, 1), Anchor("BOTTOMRIGHT", 1, -1) },
            backgroundTexture   = {
                drawLayer       = "BACKGROUND",
                setAllPoints    = true,
                color           = Color(0.2, 0.2, 0.2, 0.8),
            },
            backdrop            = {
                edgeFile        = [[Interface\Buttons\WHITE8x8]],
                edgeSize        = 1,
            },

            backdropBorderColor = Color.BLACK,
        },
    }, 

    nameLabel                   = {
        location                = { Anchor("CENTER") },
    },
}
```

You can check the [AshToAsh](https://www.curseforge.com/wow/addons/ashtoash) and [Aim](https://www.curseforge.com/wow/addons/aim) 
to check usage of those indicators.


## Wow Dynamic Value API

In the previous example, we used `Wow.UnitHealth()`, `Wow.UnitHealthMax()` and other apis from 
the Wow namespace, they are defined based on the Reactive system but easily to be used.

They'll check the binding ui element's parent until find an unit frame, and use the unit of the
frame(also dynamic) to generate the values based on different events to those ui element's style property.

Their definition can be found in [UnitAPI.lua](https://github.com/kurapica/Scorpio/blob/master/Scorpio.Unit/Modules/UnitAPI.lua),
[UnitCastAPI.lua](https://github.com/kurapica/Scorpio/blob/master/Scorpio.Unit/Modules/UnitCastAPI.lua) and
[UnitHealthAPI.lua](https://github.com/kurapica/Scorpio/blob/master/Scorpio.Unit/Modules/UnitHealthAPI.lua).

Take the `Wow.UnitName` as an example:

```lua
__Static__() __AutoCache__()
function Wow.UnitThreatLevel()
    -- Wow.FromUnitEvent will bind the unit frame's unit and the UNIT_THREAT_SITUATION_UPDATE
    -- systen event to generate dynamic values(here the unit is the same for one element ui
    --, just triggered when the situation updated)
    return Wow.FromUnitEvent("UNIT_THREAT_SITUATION_UPDATE"):Map(function(unit)
        return UnitIsPlayer(unit) and UnitThreatSituation(unit) or 0
    end)
end
```

Here is the full list of those APIs can be used for the element ui that created on the unit frames.

