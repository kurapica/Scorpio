# ConfigNode

The config node system is used for adddon configurations, it's designed on the saved variables, but will take care all the details. Please don't use it with SVMananger(you still can use it, but not recommend).

## A simple start

Here is an example addon to show how to use the config node, a simple addons have one saved variables:

```toc
## Interface: 90205
## Interface-Retail: 90205
## Interface-Classic: 11403
## Interface-BCC: 20504
## Dependencies: Scorpio
## SavedVariables: TestAddonSave

# Core
TestAddon.lua
```

A simple addon with one node config field:

```lua
Scorpio "TestAddon" ""

function OnLoad()
	-- Binding the _Config with the saved variables
	_Config:SetSavedVariable("TestAddonSave")
end

-- Declare a field "log" to the _Config with default value 3
-- the function will be called when player entering the game
-- or the field value changed
__Config__(_Config, "log", 3)
function SetLogLevel(lvl)
	print("[Config]Log Level is", lvl)
end

--- Declare a slash command to change the log level of the addon
__SlashCmd__ "test" "log"
function OnSlashCmdLogLevel(lvl)
	-- Call the SetLogLevel to change the level
    SetLogLevel(floor(lvl))
end
```

So, with the addon:

1. Entering the game, it'll print the `[Config]Log Level is 3`.
2. Then use `/test log 1`, it'll print `[Config]Log Level is 1`.
3. Reload the game, it'll print `[Config]Log Level is 1`, so the field data is saved and can be reloaded.


The main purpose of the config node system is to split the saved variable definitions to where it's used, and just keep using the pure function code style to simple the codes.

We use `3` as the default value of the `log` field, so the field will be declared to accept number value only. The field value type not only should be simple value, also enum, array, dictionary and other complex structure data types can be used. Based on the types, the system can choose the matched UI widget to show or modify the field value when the **auto-gen config panel** is used.


## Global, Char, Spec, WarMode Config Node

In the example, `_Config` is used to bind saved variable, and be used to declare the config field with handlers by `__Config__`. Just like `_Addon`, `_Name`, the `_Config` is a property of the Scorpio Modules, it'll only be created when you first access it.

THe `_Config` represents the global config for all the characters. Besides, there are other config properties:

* `_Config` as the global config for all characters.

* `_CharConfig` for each character, `_CharConfig` can use `SetSavedVariable` method bind a new saved variable for the character only, or it'll use the global saved variable to save it's config data.

* `_SpecConfig` for each character's each specialization(In classic, the specialization will always be 1).

* `_WarModeConfig` for character's each specialization's each warmode(pve, pvp, in classic, the warmode will always be pve).

So, when player switch the specialization, the spec config node will be re-inited by the saved variables, and all the handlers will receive the new field values, the warmode config node works the same way.

THe `_SpecConfig` and `_WarModeConfig`  can't use the `SetSavedVariable`.

Now, we can have a more complex example:


```toc
## Interface: 90205
## Interface-Retail: 90205
## Interface-Classic: 11403
## Interface-BCC: 20504
## Dependencies: Scorpio
## SavedVariables: TestAddonSave
## SavedVariablesPerCharacter: TestAddonCharSave

# Core
TestAddon.lua
```

A simple addon with one node config field:

```lua
Scorpio "TestAddon" ""

function OnLoad()
	-- Binding the _Config with the saved variables
	_Config:SetSavedVariable("TestAddonSave")
	_CharConfig:SetSavedVariable("TestAddonCharSave")
end

-- Declare a field "log" to the _Config with default value 3
-- the function will be called when player entering the game
-- or the field value changed
__Config__(_Config, "log", 3)
function SetLogLevel(lvl)
	print("[Config]Log Level is", lvl)
end

__Config__(_CharConfig, "location", {
	x = Number,
	y = Number
})
function SetLocation(loc)
	print("[CharConfig]Location is", Toolset.tostring(loc))
end

__Config__(_SpecConfig, "action", { Number })
function SetActions(actions)
	print("[SpecConfig]Actions are", Toolset.tostring(actions))
end

__Config__(_WarModeConfig, "mode", true)
function SetWarMode(mode)
	print("[WarModeConfig]Mode is", mode)
end
```




## Config Node and Sub-Node



## Node Field



## Node Field Type



## Observable Node Field



## Widgets For Node Fields



## Auto-gen config panel