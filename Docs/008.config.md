# ConfigNode

The config node system is used for adddon configurations, it's designed on the saved variables, but will black box the details. Please don't use it combined with SVMananger(you still can use it, but not recommend).

## A simple start

Here is an example addon to show how to use the config node, a simple addon have one saved variables:

```toc
## Interface: 90205
## Interface-Retail: 90205
## Interface-Classic: 11403
## Interface-BCC: 20504
## Dependencies: Scorpio
## SavedVariables: TestAddonSave

# Core
TestAddon.lua
```

With one config node field:

```lua
Scorpio "TestAddon" ""

function OnLoad()
	-- Binding the _Config with the saved variables
	-- Must be used within the OnLoad
	_Config:SetSavedVariable("TestAddonSave")
end

-- Declare a field "log" to the _Config with default value 3
-- the function will be called when player entering the game
-- or the field value changed
__Config__(_Config, "log", 3)
function SetLogLevel(lvl)
	print("[Config]Log Level is", lvl)
end

--- Declare a slash command to change the log level of the addon
__SlashCmd__ "test" "log"
function OnSlashCmdLogLevel(lvl)
	-- Call the SetLogLevel to change the level
    SetLogLevel(floor(lvl))
end
```

So, with the addon:

1. Entering the game, it'll print the `[Config]Log Level is 3`.
2. Then use `/test log 1`, it'll print `[Config]Log Level is 1`.
3. Reload the game, it'll print `[Config]Log Level is 1`, so the field data is saved and can be reloaded.


The main purpose of the config node system is to split the saved variable declaration and usages to where it's used, and just keep using the pure function code style to simple the codes.

We use `3` as the default value of the `log` field, so the field will be declared to accept number value only. The field value type can be scalar values, also enum, array, dictionary and other complex structure data types can be used. Based on the types, the system can choose the matched UI widget to show or modify the field value when the **auto-gen config panel** is used.


## Global, Char, Spec, WarMode Config Node

In the example, `_Config` is used to bind saved variable, and used to declare the config field with handlers by `__Config__`. Just like `_Addon`, `_Name`, the `_Config` is a property of the Scorpio Modules, it'll only be created when it's accessed for the first time.

The `_Config` represents the global config for all the characters, there are config node for other usages, there is the full list:

1. `_Config` as the global config for all characters.

2. `_CharConfig` for each character, `_CharConfig` can use `SetSavedVariable` method bind a new saved variable for the character only, or it'll use the global saved variable to save it's config data.

3. `_SpecConfig` for character's specialization(In classic, the specialization will always be 1).

4. `_WarModeConfig` for specialization's warmode(pve, pvp, in classic, the warmode will always be pve).

So, when player switch the specialization, the spec config node will be re-inited by the saved variables, and all the handlers will receive the new field values, the warmode config node works the same way.

The `_SpecConfig` and `_WarModeConfig`  can't use the `SetSavedVariable`.

Now, we can have a more complex example:


```toc
## Interface: 90205
## Interface-Retail: 90205
## Interface-Classic: 11403
## Interface-BCC: 20504
## Dependencies: Scorpio
## SavedVariables: TestAddonSave
## SavedVariablesPerCharacter: TestAddonCharSave

# Core
TestAddon.lua
```

With multi node config fields:

```lua
Scorpio "TestAddon" ""

function OnLoad()
	-- Binding the _Config with the saved variables
	_Config:SetSavedVariable("TestAddonSave")
	_CharConfig:SetSavedVariable("TestAddonCharSave")
end

-- Declare a field "log" to the _Config with default value 3
-- the function will be called when player entering the game
-- or the field value changed
__Config__(_Config, "log", 3)
function SetLogLevel(lvl)
	print("[Config]Log Level is", lvl)
end

-- The data is like `{["y"]=3,["x"]=1}`
__Config__(_CharConfig, "location", {
	x = Number,
	y = Number
})
function SetLocation(loc)
	print("[CharConfig]Location is", Toolset.tostring(loc))
end

-- The data is like `{1, 2, 3, 4, 5 }`
__Config__(_SpecConfig, "action", { Number })
function SetActions(actions)
	print("[SpecConfig]Actions are", Toolset.tostring(actions))
end

-- The data is like `true|false`
__Config__(_WarModeConfig, "mode", true)
function SetWarMode(mode)
	print("[WarModeConfig]Mode is", mode)
end
```

The usage of `__Config__`  is

```lua
__Config__(configNode[, name][, type][, default])
```

It's combined with four elements:

1. **Config Node** or sub config node, required.

2. **Field name**, optional, the function name will be used as default.

3. **Field data type**, optional, it can be any scalar, enum or struct type. The system can figure out the scalar data type based on the default value(like Number, String, Boolean).

4. **Default**, optional.


## Config Node and Sub-Node

The config node is the container of node fields. It also can contains sub-config nodes.



## Node Field



## Node Field Type


## Default Value



## Observable Node Field



## Widgets For Node Fields



## Auto-gen config panel